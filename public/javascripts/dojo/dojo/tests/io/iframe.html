<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Testing dojo.io.iframe</title>
    <style type="text/css">
      @import "../../resources/dojo.css";
    </style>
    <script type="text/javascript" 
	    src="../../dojo.js" djConfig="isDebug: true"></script>
    <script type="text/javascript">
      dojo.require("dojo.io.iframe");
      
      function ioIframeGetText(t){
	  var td = dojo.io.iframe.send({
	      url: "iframeResponse.text.html",
	      method: "GET",
	      timeoutSeconds: 5,
	      preventCache: true,
	      handle: function(res, ioArgs){
		  if(!(res instanceof Error)){
		      console.group("text iframe");
		      console.dir(res);
		      console.groupEnd();
		  }else{
		      console.error("text iframe error");
		  }
	      }
	  });
      }
      
      function ioIframeGetJson(t){
	  var td = dojo.io.iframe.send({
	      url: "iframeResponse.json.html",
	      method: "GET",
	      timeoutSeconds: 5,
	      preventCache: true,
	      handleAs: "json",
	      handle: function(res, ioArgs){
		  if(!(res instanceof Error)){
		      console.group("json iframe");
		      console.dir(res.color);
		      console.groupEnd();
		  }else{
		      console.error("json iframe error");
		  }
	      }		
	  });
      }

      function ioIframeGetJavascript(t){
	  var d = new doh.Deferred();
	  var td = dojo.io.iframe.send({
	      url: "iframeResponse.js.html",
	      method: "GET",
	      timeoutSeconds: 5,
	      preventCache: true,
	      handleAs: "javascript",
	      handle: function(res, ioArgs){
		  console.log("RES: ", res);
		  if(!(res instanceof Error)){
		      console.group("javascript iframe");
		      console.dir(window.iframeTestingFunction());
		      console.groupEnd();
		  }else{
		      console.error("javascript iframe error");
		  }								
	      }
	  });
      }
      
      function ioIframeGetHtml(t){
	  var d = new doh.Deferred();
	  var td = dojo.io.iframe.send({
	      url: "iframeResponse.html",
	      method: "GET",
	      timeoutSeconds: 5,
	      preventCache: true,
	      handleAs: "html",
	      handle: function(res, ioArgs){
		  if(!(res instanceof Error)){
		      console.group("html iframe");
		      console.dir(res.getElementsByTagName("h1")[0].innerHTML);
		      console.groupEnd();
		  }else{
		      console.error("html iframe error");
		  }								
	      }
	  });
      }

      function ioIframeContentArray(t){
	  //Tests if an array passed in content causes as an error on cleanup.
	  var td = dojo.io.iframe.send({
	      url: "iframeResponse.text.html",
	      form: "contentArrayTest",
	      content: {"tag": ["value1","value2"]},
	      handle: function(res, ioArgs){
		  if(!(res instanceof Error)){
		      console.group("array iframe");
		      console.dir(res);
		      console.groupEnd();
		  } else {
		      console.error("array iframe error");
		  }
	      }
	  });
      }
      
      dojo.addOnLoad(function(){
	  var td = dojo.io.iframe.send({
	      url: "iframeResponse.text.html",
	      timeoutSeconds: 5,
	      preventCache: true,
	      handle: function(res, ioArgs){
		  if(!(res instanceof Error) && 
		     "iframe succeeded" == res){
		      console.debug("OK");
		  }else{
		      console.debug("Error", res);
		  }								
	      }
	  });
      });
      
    </script>
  </head>
  <body>
    
    <form id="contentArrayTest" method="get" enctype="multipart/form-data">
    </form>
  </body>
</html>
